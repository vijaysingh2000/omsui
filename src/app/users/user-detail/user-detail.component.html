<!-- Modal Backdrop -->
<div class="modal-backdrop" (click)="close()"></div>

<!-- Modal Panel -->
<div class="detail-modal" role="dialog" aria-modal="true" aria-labelledby="userDetailTitle">

  <!-- Header -->
  <div class="detail-header">
    <h4 id="userDetailTitle" class="mb-0">
      üë§
      @if (isNew) { New User }
      @else if (user) {
        {{ [user.firstName, user.lastName].join(' ').trim() || 'User Details' }}
        <span class="id-badge">ID: {{ userId }}</span>
      } @else { User Details }
    </h4>
    <button class="btn-close-x" (click)="close()" aria-label="Close">‚úï</button>
  </div>

  <!-- Body -->
  <div class="detail-body">

    @if (loading) {
      <div class="text-center py-5 text-muted">
        <span class="spinner-border spinner-border-sm me-2"></span> Loading user‚Ä¶
      </div>
    } @else if (errorMsg && !user) {
      <div class="alert alert-danger">{{ errorMsg }}</div>
    } @else if (user) {

      @if (errorMsg) {
        <div class="alert alert-danger alert-dismissible" role="alert">
          {{ errorMsg }}<button type="button" class="btn-close" (click)="errorMsg = null"></button>
        </div>
      }
      @if (successMsg) { <div class="alert alert-success">{{ successMsg }}</div> }

      <form (ngSubmit)="save()" #detailForm="ngForm" novalidate>

        <!-- Section: Identity -->
        <div class="form-section">
          <div class="section-title">üë§ Identity</div>
          <div class="row g-3">

            <div class="col-md-6">
              <label class="form-label">First Name</label>
              <input type="text" class="form-control form-control-sm" name="firstName"
                     [(ngModel)]="user.firstName" placeholder="First name" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Last Name</label>
              <input type="text" class="form-control form-control-sm" name="lastName"
                     [(ngModel)]="user.lastName" placeholder="Last name" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Email <span class="required">*</span></label>
              <input type="email" class="form-control form-control-sm" name="email"
                     [(ngModel)]="user.email" placeholder="Email address" required />
            </div>

            <div class="col-md-6">
              <label class="form-label">Login ID <span class="required">*</span></label>
              <input type="text" class="form-control form-control-sm" name="loginId"
                     [(ngModel)]="user.loginId" placeholder="Login ID" required />
            </div>

          </div>
        </div>

        <!-- Section: Access & Status -->
        <div class="form-section">
          <div class="section-title">üîê Access &amp; Status</div>
          <div class="row g-3">

            <div class="col-md-6">
              <label class="form-label">Access Type</label>
              <select class="form-select form-select-sm" name="type" [(ngModel)]="user.type">
                @for (opt of userTypeOptions; track opt.value) {
                  <option [ngValue]="opt.value">{{ opt.label }}</option>
                }
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">Status</label>
              <select class="form-select form-select-sm" name="isActive" [(ngModel)]="user.isActive">
                <option [ngValue]="true">Active</option>
                <option [ngValue]="false">Inactive</option>
              </select>
            </div>

            @if (isNew) {
              <div class="col-md-6">
                <label class="form-label">Password <span class="required">*</span></label>
                <input type="password" class="form-control form-control-sm" name="password"
                       [(ngModel)]="user.password" placeholder="Password" [required]="isNew" />
              </div>
            }

          </div>
        </div>

        <!-- Footer -->
        <div class="detail-footer">
          <button type="button" class="btn btn-sm btn-outline-secondary" (click)="close()">Cancel</button>
          <button type="submit" class="btn btn-sm btn-primary" [disabled]="saving">
            @if (saving) { <span class="spinner-border spinner-border-sm me-1"></span> Saving‚Ä¶ }
            @else { üíæ Save }
          </button>
        </div>

      </form>
    }

  </div>
</div>
