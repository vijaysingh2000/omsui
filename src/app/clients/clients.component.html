<div class="oms-shell">

  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Main Content -->
  <main class="oms-main">

    <!-- Header -->
    <div class="page-header d-flex align-items-center justify-content-between mb-3">
      <div>
        <h2 class="page-title mb-0">üè¢ Clients</h2>
        <p class="text-muted small mb-0">Manage and view client records</p>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-sm btn-primary" (click)="openNewClient()">
          Ôºã New Client
        </button>
        <button class="btn btn-sm btn-outline-primary" (click)="load()" [disabled]="loading">
          @if (loading) {
            <span class="spinner-border spinner-border-sm me-1" role="status"></span> Loading‚Ä¶
          } @else {
            ‚Ü∫ Refresh
          }
        </button>
      </div>
    </div>

    <!-- Error -->
    @if (errorMsg) {
      <div class="alert alert-danger alert-dismissible fade show rounded-3" role="alert">
        <strong>Error:</strong> {{ errorMsg }}
        <button type="button" class="btn-close" (click)="errorMsg = null"></button>
      </div>
    }

    <!-- Search + Table Card -->
    <div class="oms-card">
      <div class="oms-card-header d-flex align-items-center justify-content-between">
        <span>üìã Client List</span>
        <span class="badge rounded-pill bg-white text-primary border border-primary px-3">
          {{ filtered.length }} record(s)
        </span>
      </div>

      <div class="oms-card-body">

        <!-- Search Bar -->
        <div class="mb-3">
          <input
            type="text"
            class="form-control form-control-sm"
            placeholder="üîç Search by name, contact, email, phone or city‚Ä¶"
            [(ngModel)]="searchText"
          />
        </div>

        <!-- Table -->
        @if (loading && clients.length === 0) {
          <div class="text-center py-5 text-muted">
            <span class="spinner-border spinner-border-sm me-2"></span> Loading clients‚Ä¶
          </div>
        } @else if (filtered.length === 0) {
          <div class="text-center py-5 text-muted">
            <div class="display-5 mb-2">üîé</div>
            <p>No clients found.</p>
          </div>
        } @else {
          <div class="table-responsive">
            <table class="table table-hover table-sm client-table align-middle">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Contact Person</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>City</th>
                  <th>State</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                @for (c of filtered; track c.id) {
                  <tr>
                    <td>
                      <a class="client-link" href="javascript:void(0)" (click)="openDetail(c.id)">
                        {{ c.name || '‚Äî' }}
                      </a>
                    </td>
                    <td>{{ c.contactPerson || '‚Äî' }}</td>
                    <td>{{ c.email || '‚Äî' }}</td>
                    <td class="text-nowrap">{{ c.phone || '‚Äî' }}</td>
                    <td>{{ c.city || '‚Äî' }}</td>
                    <td>{{ c.state || '‚Äî' }}</td>
                    <td>
                      @if (c.active) {
                        <span class="badge bg-success">Active</span>
                      } @else {
                        <span class="badge bg-secondary">Inactive</span>
                      }
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        }

      </div>
    </div>

  </main>

  <!-- Client Detail Modal -->
  @if (showDetail) {
    <app-client-detail
      [clientId]="selectedClientId"
      (closed)="closeDetail()"
      (saved)="onDetailSaved()"
    ></app-client-detail>
  }

</div>
