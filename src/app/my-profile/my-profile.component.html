<div class="oms-shell">

  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Main Content -->
  <main class="oms-main">

    @if (loading) {
      <div class="profile-loading">
        <span class="spinner-border text-primary" role="status"></span>
        <span class="ms-2 text-muted">Loading profile…</span>
      </div>
    } @else {
      <div class="profile-card-wrap">
        <div class="profile-card">

          <!-- Card Title Bar -->
          <div class="profile-titlebar">
            <span class="profile-title-icon">&#x1F464;</span>
            <span>User Details [{{ firstName }}, {{ lastName }}]</span>
          </div>

          <!-- Alerts -->
          @if (errorMsg) {
            <div class="alert alert-danger alert-dismissible mx-4 mt-3 mb-0 py-2 small" role="alert">
              {{ errorMsg }}
              <button type="button" class="btn-close btn-close-sm" (click)="errorMsg=null"></button>
            </div>
          }
          @if (successMsg) {
            <div class="alert alert-success alert-dismissible mx-4 mt-3 mb-0 py-2 small" role="alert">
              {{ successMsg }}
              <button type="button" class="btn-close btn-close-sm" (click)="successMsg=null"></button>
            </div>
          }

          <!-- Form -->
          <form (ngSubmit)="save()" #profileForm="ngForm" class="profile-form" novalidate>
            <div class="profile-fields">

              <!-- Left Column -->
              <div class="profile-col">
                <div class="profile-field">
                  <label for="loginId" class="profile-label">Login Id</label>
                  <input id="loginId" type="text" class="form-control form-control-sm profile-input"
                         name="loginId" [(ngModel)]="loginId" required />
                </div>

                <div class="profile-field">
                  <label for="password" class="profile-label">Password</label>
                  <input id="password" type="password" class="form-control form-control-sm profile-input"
                         name="password" [(ngModel)]="password"
                         autocomplete="new-password" />
                </div>

                <div class="profile-field">
                  <label for="confirmPassword" class="profile-label">Confirm Password</label>
                  <input id="confirmPassword" type="password"
                         class="form-control form-control-sm profile-input"
                         [class.is-invalid]="confirmPassword && passwordMismatch"
                         name="confirmPassword" [(ngModel)]="confirmPassword"
                         autocomplete="new-password" />
                  @if (confirmPassword && passwordMismatch) {
                    <div class="invalid-feedback">Passwords do not match.</div>
                  }
                </div>
              </div>

              <!-- Right Column -->
              <div class="profile-col">
                <div class="profile-field">
                  <label for="firstName" class="profile-label">First name</label>
                  <input id="firstName" type="text" class="form-control form-control-sm profile-input"
                         name="firstName" [(ngModel)]="firstName" required />
                </div>

                <div class="profile-field">
                  <label for="lastName" class="profile-label">Last name</label>
                  <input id="lastName" type="text" class="form-control form-control-sm profile-input"
                         name="lastName" [(ngModel)]="lastName" required />
                </div>

                <div class="profile-field">
                  <label for="email" class="profile-label">Email</label>
                  <input id="email" type="email" class="form-control form-control-sm profile-input"
                         name="email" [(ngModel)]="email" required email />
                </div>

                <div class="profile-field">
                  <label class="profile-label">User Type</label>
                  <input type="text" class="form-control form-control-sm profile-input"
                         [value]="userTypeName" readonly />
                </div>

                <div class="profile-field">
                  <label class="profile-label">Status</label>
                  <div class="pt-1">
                    @if (isActive) {
                      <span class="badge text-bg-success px-3 py-2">&#x2713; Active</span>
                    } @else {
                      <span class="badge text-bg-secondary px-3 py-2">Inactive</span>
                    }
                  </div>
                </div>

                <div class="profile-field">
                  <label class="profile-label">Assigned Clients</label>
                  @if (assignedClients.length === 0) {
                    <div class="text-muted small pt-1">— None assigned —</div>
                  } @else {
                    <div class="d-flex flex-wrap gap-1 pt-1">
                      @for (c of assignedClients; track c.id) {
                        <span class="badge text-bg-light text-dark border">{{ c.name }}</span>
                      }
                    </div>
                  }
                </div>
              </div>

            </div>

            <!-- Actions -->
            <div class="profile-actions">
              <button type="submit" class="btn btn-sm profile-btn-save"
                      [disabled]="saving || profileForm.invalid || passwordMismatch">
                @if (saving) {
                  <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
                }
                Save
              </button>
              <button type="button" class="btn btn-sm profile-btn-close" (click)="close()">
                Close
              </button>
            </div>

          </form>
        </div>
      </div>
    }

  </main>
</div>
